.container-fluid > .navbar-collapse {
margin-right: 0;
margin-left: 0;
}
.navbar-static-top {
border-radius: 0;
}
.navbar-fixed-top,
.navbar-fixed-bottom {
border-radius: 0;
}
.navbar-toggle {
display: none;
}
.navbar-nav {
float: left;
margin: 0;
}
.navbar-nav > li {
float: left;
}
.navbar-nav > li > a {
padding-top: 15px;
padding-bottom: 15px;
}
.navbar-nav.navbar-right:last-child {
margin-right: -15px;
}
.navbar-left {
float: left !important;
}
.navbar-right {
float: right !important;
}
.navbar-form .form-group {
display: inline-block;
margin-bottom: 0;
vertical-align: middle;
}
.navbar-form .form-control {
display: inline-block;
width: auto;
vertical-align: middle;
}
.navbar-form .control-label {
margin-bottom: 0;
vertical-align: middle;
}
.navbar-form .radio,
.navbar-form .checkbox {
display: inline-block;
padding-left: 0;
margin-top: 0;
margin-bottom: 0;
vertical-align: middle;
}
.navbar-form .radio input[type='radio'],
.navbar-form .checkbox input[type='checkbox'] {
float: none;
margin-left: 0;
}
.navbar-form .has-feedback .form-control-feedback {
top: 0;
}
.navbar-form {
width: auto;
padding-top: 0;
padding-bottom: 0;
margin-right: 0;
margin-left: 0;
border: 0;
-webkit-box-shadow: none;
box-shadow: none;
}
.navbar-form.navbar-right:last-child {
margin-right: -15px;
}
.navbar-text {
float: left;
margin-right: 15px;
margin-left: 15px;
}
.navbar-text.navbar-right:last-child {
margin-right: 0;
}
}"
#################################################
### Rada-Iglesias Lab SV Effect Prediction Tool
#################################################
##To consider bioconductor repos
##To avoid this error: https://community.rstudio.com/t/deployment-error-unable-to-determine-the-location-for-some-packages/102312
# options(repos = BiocManager::repositories())
#options('repos')
library(shiny)
library(waiter)
library(shinybusy)
library(shinyjs)
library(shinyWidgets)
library(DT)
library(plotrix)##For enhancers, ellipse shape representation
library(shape)##For curve arrows representation
library(diagram)##For curve arrows representation
##Librerias para el liftover tratar de poner aqui
##Si se cargan dentro del source de la funcion tarda la vida
# library(liftOver)
# library(GenomicRanges)
# library(rtracklayer)
# library(reticulate)
###Setwd in the folder where all the app info is hosted
# setwd("~/Dropbox/Cantabria/PhD_Project/ScriptsPhd/ScriptsParaUsoLocal/Postre/Postre_app")
####################################
###Let's load required Functions
####################################
source(file = "functions/MasterWrapperSinglePrediction.R",local = TRUE)##many other functions loaded here
source(file = "functions/error_Report.R",local = TRUE)
source(file = "functions/noGenesFound_report.R",local = TRUE)
##############################################
##Functions for Multiple Patients Submission
##############################################
source("functions/multiple_SV_Functions/cohortResults_Parser.R", local = TRUE)
source("functions/multiple_SV_Functions/multipleStats_ExplorePreviousPat_htmlGeneration.R",local=TRUE)
##To deal with rounding .5 problems
##round2 function
source(file = "functions/roundingHalfs.R", local = FALSE) ##Local == FALSE to be loaded in the global env so that all functions can find it
####################################################################################################
##Patients tables for User Easy Submission. Maybe only loading when Submission of this kind done
##Also if database huge it may crash the app, so maybe for the future, load only specific patients
##Or add metadata to the value line so no need to load anything, but... in this case html will increase accordingly
##Maybe having 1 file per patient and reading specific file. That will remove data loaded to memory.
##But for now, managable with loading data frames
####################################################################################################
load("data/patientTables/usrGuide_SingleSubmTable.RData")
##Loading allPatients Used for the explorePreviousPatient section
load("data/patientTables/AllPatientsInfo.RData")
##Scores For Considering Relevant result
##minRequired scores for heatmap coloring and geneReport generation
minScore<-0.8
highScore<-0.9
###Meter como variables, todos los valores que  estan estaticos en el menu
relevantChr<-c(paste("chr",1:22,sep = ""), "chrX")##chrY excluded not all data available for chrY
#To avoid navbar collapse in smaller screens
# https://stackoverflow.com/questions/21738417/bootstrap-remove-responsive-from-navbar
navbar_js<-"@media (max-width: 768px) {
.navbar-header {
float: left;
}
.navbar {
border-radius: 4px;
min-width: 400px;
}
.nav-tabs-justified > li > a {
border-bottom: 1px solid #ddd;
border-radius: 4px 4px 0 0;
}
.nav-tabs-justified > .active > a,
.nav-tabs-justified > .active > a:hover,
.nav-tabs-justified > .active > a:focus {
border-bottom-color: #fff;
}
.nav-justified > li {
display: table-cell;
width: 1%;
}
.nav-justified > li > a {
margin-bottom: 0;
}
.nav-tabs.nav-justified > li > a {
border-bottom: 1px solid #ddd;
border-radius: 4px 4px 0 0;
}
.nav-tabs.nav-justified > .active > a,
.nav-tabs.nav-justified > .active > a:hover,
.nav-tabs.nav-justified > .active > a:focus {
border-bottom-color: #fff;
}
.nav-tabs.nav-justified > li {
display: table-cell;
width: 1%;
}
.nav-tabs.nav-justified > li > a {
margin-bottom: 0;
}
.navbar-right .dropdown-menu {
right: 0;
left: auto;
}
.navbar-right .dropdown-menu-left {
right: auto;
left: 0;
}
.container {
min-width: 400px;
}
.navbar-collapse {
width: auto;
border-top: 0;
box-shadow: none;
}
.navbar-collapse.collapse {
display: block !important;
height: auto !important;
padding-bottom: 0;
overflow: visible !important;
}
.navbar-collapse.in {
overflow-y: visible;
}
.navbar-fixed-top .navbar-collapse,
.navbar-static-top .navbar-collapse,
.navbar-fixed-bottom .navbar-collapse {
padding-right: 0;
padding-left: 0;
}
.container > .navbar-header,
.container-fluid > .navbar-header,
.container > .navbar-collapse,
.container-fluid > .navbar-collapse {
margin-right: 0;
margin-left: 0;
}
.navbar-static-top {
border-radius: 0;
}
.navbar-fixed-top,
.navbar-fixed-bottom {
border-radius: 0;
}
.navbar-toggle {
display: none;
}
.navbar-nav {
float: left;
margin: 0;
}
.navbar-nav > li {
float: left;
}
.navbar-nav > li > a {
padding-top: 15px;
padding-bottom: 15px;
}
.navbar-nav.navbar-right:last-child {
margin-right: -15px;
}
.navbar-left {
float: left !important;
}
.navbar-right {
float: right !important;
}
.navbar-form .form-group {
display: inline-block;
margin-bottom: 0;
vertical-align: middle;
}
.navbar-form .form-control {
display: inline-block;
width: auto;
vertical-align: middle;
}
.navbar-form .control-label {
margin-bottom: 0;
vertical-align: middle;
}
.navbar-form .radio,
.navbar-form .checkbox {
display: inline-block;
padding-left: 0;
margin-top: 0;
margin-bottom: 0;
vertical-align: middle;
}
.navbar-form .radio input[type='radio'],
.navbar-form .checkbox input[type='checkbox'] {
float: none;
margin-left: 0;
}
.navbar-form .has-feedback .form-control-feedback {
top: 0;
}
.navbar-form {
width: auto;
padding-top: 0;
padding-bottom: 0;
margin-right: 0;
margin-left: 0;
border: 0;
-webkit-box-shadow: none;
box-shadow: none;
}
.navbar-form.navbar-right:last-child {
margin-right: -15px;
}
.navbar-text {
float: left;
margin-right: 15px;
margin-left: 15px;
}
.navbar-text.navbar-right:last-child {
margin-right: 0;
}
}"
navbarPage(title = "POSTRE",
id = "inTabset",
tabPanel(title = "Single SV Submission",
value = "SingleSubmissionTab",
icon=icon("dna"),
div(class="patientInputPanel",
includeHTML("html_scripts/Single_SV_Submission_Interface.html"),
######################
## Patient Input Panel
######################
div(class="sideBarClass",
##If I put here on the html, h2 tag it gets styled as the header, so style features
##are connected
div(class="formAndTitle_patientInput",
##Patient SV type
HTML('<h2 id="titleSideBarPannel">Introduce Structural Variant and Phenotype</h2>'),
div(class="patientFormulary",
div(class="inp1",
wellPanel(selectInput(inputId = "typeSV", label = "Type SV",
choices = c("Deletion","Duplication","Inversion","Translocation"),
selected = "Inversion"))
),
div(class="inp2",
##Patient Phenotype
wellPanel(selectInput(inputId = "phenoPatient",
label = "Phenotype",
##Choices full name is then matched & renamed in GenomicData_Loader.R
##Alphabet order
choices = c("Cardiovascular",
"Head & Neck",
"Limbs",
"Neurodevelopmental"
),
selected ="Head & Neck" ))
),
##SV coordinates
div(class="inp3",
###Breakpoint 1
wellPanel(
selectInput(inputId = "bp1_chr",
label = "Breakpoint 1 chromosome",
choices = relevantChr,
selected="chr6"),
textInput(inputId = "bp1_coord",
label = "Breakpoint 1 coordinates (coord1,coord2 if interval)",
value = "10355280")
)),
div(class="inp4",
###Breakpoint 2
wellPanel(
selectInput(inputId = "bp2_chr",
label = "Breakpoint 2 chromosome",
choices = relevantChr,
selected = "chr6"),
textInput(inputId = "bp2_coord",
label = "Breakpoint 2 coordinates (coord1,coord2 if interval)",
value = "99103873")
)),
##Specifying reference Genome
div(class="inp5",
# wellPanel(selectInput(inputId = "refGenome", label = "Reference Genome",
#                       choices = c("hg19","hg38"),
#                       selected = "hg19"))
wellPanel(
div(class="textRefGenome",
HTML('<h4><b>NOTE: Reference Genome Coordinates required in GRCh37/hg19</b></h4>'),
HTML('<p style="font-size:15px;">Please, visit any of the following websites to convert your coordinates to hg19 if you need it:
<a href= "http://genome.ucsc.edu/cgi-bin/hgLiftOver" target="_blank">UCSC LiftOver</a>,
<a href= "https://www.ensembl.org/Homo_sapiens/Tools/AssemblyConverter?db=core" target="_blank">ENSEMBL Assembly Converter</a>,
<a href= "https://liftover.broadinstitute.org/" target="_blank">Broad Institute LiftOver</a>
')
)
),
),
##Selecting Running Mode
div(class="inp6",
wellPanel(selectInput(inputId = "runMode_single", label = "Running mode",
choices = c("Standard","High-Specificity"),
selected = "Standard"))
),
div(class="submission",
#Send request
actionButton(inputId = "click",
label = "Submit",
icon("paper-plane"),
style="color: #fff; background-color: #1D3354; border-color: #467599;")
)
)
)
)
)
),
tabPanel(title = "Single SV Results",
value = "overview",
icon=icon("poll"),
div(class="heatmapPage",
tableOutput(outputId = "masterSummary_result")
),
##TO AVOID OVERWRITTING THE PLOT VARIABLE:
##I need to add another outputTable for the results derived of the UsrGuide_SingleSubmission section
##If don't, and I try to put all results in masterSummary_result table, the tool does not work properly,
##Because one of the two reactive events stop working
div(class="heatmapPage",
tableOutput(outputId = "masterSummary_result_usrGuide_SingleSubmission")
),
div(class="heatmapPage",
tableOutput(outputId = "masterSummary_result_explorePreviousPatient_SingleSubmission")
),
div(class="heatmapPage",
tableOutput(outputId = "masterSummary_result_MultipleSVSubmission_SingleSubmission")
)
),
tabPanel(title = "Multiple SV Submission",
value = "multiple_Submission",
icon=icon("dna"),
div(class="patientInputPanel",
includeHTML("html_scripts/Multiple_SV_Submission_Interface.html"),
######################
## Multiple SV Input Panel
######################
div(class="sideBarClassMultiple",
##If I put here on the html, h2 tag it gets styled as the header, so style features
##are connected
#START MULTIPLE SUBMISSION
div(class="formAndTitle_patient_Multiple_Input",
##Patient SV type
HTML('<h2 id="titleSideBarPannel">Upload Multiple Structural Variants with Phenotypes</h2>'),
div(class="patientMultipleFormulary",
div(class="multipleSubmission",
wellPanel(fileInput(
inputId = "multipleFileInfo",
label="SelectFile",
multiple = FALSE,
accept = ".tsv"
),style = "padding: 5px; padding-bottom:0px;")
),
##Selecting Running Mode
div(
wellPanel(selectInput(inputId = "runMode_Multiple", label = "Running mode",
choices = c("Standard","High-Specificity"),
selected = "Standard"))
),
div(class="submission",
id="multipleSubm",
##Send request
actionButton(inputId = "clickMultiple",
label = "Submit",
icon("paper-plane"),
style="color: #fff; background-color: #1D3354; border-color: #467599;")
)
)
)
#######END MULTIP SUBMISSION
)
)
),
tabPanel(title = "Multiple SV Results",
value = "multiple_overview",
icon=icon("poll"),
##Same format that for Explore Previous Patients Section
div(class="previousPatientsPage",
tableOutput(outputId = "master_multipleStats")
)
),
tags$head(tags$style(HTML(navbar_js)))
)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
source('~/.active-rstudio-document')
runApp()
runApp()
runApp()
##Instruction 1: Managing & Loading Dependencies
source("https://raw.githubusercontent.com/vicsanga/Postre/main/Managing_Postre_Dependencies.R")
##Instruction 2: Running Postre
runGitHub("Postre", "vicsanga", subdir = "Postre_app/", launch.browser = TRUE)
runApp()
runApp()
runApp()
runApp()
runApp()
source('~/.active-rstudio-document')
?runGitHub
runUrl("https://github.com/vicsanga/Postre/blob/main/Postre_app.zip?raw=true")
runUrl("https://github.com/vicsanga/Postre/blob/main/Postre_app.zip")
?runUrl
runUrl("https://github.com/vicsanga/Postre/blob/main/Postre_app.zip?raw=true", filetype = ".zip")
##Instruction 1: Managing & Loading Dependencies
source("https://raw.githubusercontent.com/vicsanga/Postre/main/Managing_Postre_Dependencies.R")
##Alternative instruction2:
runUrl("https://github.com/vicsanga/Postre/blob/main/Postre_app.zip?raw=true", filetype = ".zip", launch.browser = TRUE)
##Instruction 2: Running Postre
runGitHub("Postre", "vicsanga", subdir = "Postre_app/", launch.browser = TRUE)
##Alternative instruction2:
runUrl("https://github.com/vicsanga/Postre/blob/main/Postre_app.zip?raw=true", filetype = ".zip", launch.browser = TRUE)
citation("shiny")
